<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Visualisator</title>

  <link rel="stylesheet" href ="css/bootstrap.css">

  <!-- Dependencies -->
  <script type="text/javascript" src="js/libs/jquery.js"></script>
  <script type="text/javascript" src="js/libs/underscore.js"></script>
  <script type="text/javascript" src="js/libs/bootstrap.js"></script>
  <script type="text/javascript" src="js/libs/backbone.js"></script>
  <script type="text/javascript" src="js/libs/moment.js"></script>

  <!-- Application -->
  <script type="text/javascript" src="js/objects.js"></script>
  <script type="text/javascript" src="js/views.js"></script>
  <script type="text/javascript" src="js/app.js"></script>
</head>

<body>

<nav class="navbar navbar-inverse navbar-static-top" role="navigation">
  <div class="container">
    <a class="navbar-brand" href="#">Visualisator</a>
  </div>
</nav>

<div class="container" id="main">

</div>

<script type="text/javascript">
window.currentPathURL = window.location.href.split('/').slice(0, -1).join('/');
window.visualisatorConfigURL = [currentPathURL, 'visualisatorConfig.json'].join('/');

$(document).ready(function() {
  window.visualisatorConfig = Utils.getJSONFile(visualisatorConfigURL);
  window.mainConfig = Utils.getJSONFile(window.visualisatorConfig.mainConfigPath);

  window.families = [];
  window.tools = {};

  _.each(window.mainConfig.families, function(rawFamily) {
    var family = new Family();
    family.set('tests', rawFamily.orderedTestIDs);
    family.set('name', rawFamily.name);

    _.each(rawFamily.serialNumbers, function(sn) {
      var tool = new Tool({sn: sn, tests: rawFamily.orderedTestIDs});
      family.tools.add(tool);
      window.tools[sn] = tool;
    });

    window.families.push(family);
  });

  var mats = Utils.getCSVFile(window.visualisatorConfig.tflsLog)
  _.each(mats, function(mat) {
    if(_.has(window.tools, mat[2])) {
      window.tools[mat[2]].parseMat(mat);
    }
  });

  var tfls = Utils.getCSVFile(window.visualisatorConfig.matsLog)
  _.each(tfls, function(tfl) {
    if(_.has(window.tools, tfl[2])) {
      window.tools[tfl[2]].parseTfl(tfl);
    }
  });

  _.each(window.families, function(family) {
    var familyView = new FamilyView(family);
    $('#main').append(familyView.render());
  });
});
</script>

</body>

</html>
