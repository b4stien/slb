<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Configurator</title>

  <link rel="stylesheet" href ="css/bootstrap.css">
  <link rel="stylesheet" href ="css/font-awesome.css">

  <!-- Dependencies -->
  <script type="text/javascript" src="js/libs/jquery.js"></script>
  <script type="text/javascript" src="js/libs/underscore.js"></script>
  <script type="text/javascript" src="js/libs/bootstrap.js"></script>
  <script type="text/javascript" src="js/libs/backbone.js"></script>
  <script type="text/javascript" src="js/libs/moment.js"></script>
  <script type="text/javascript" src="js/libs/FileSaver.js"></script>

  <!-- Application -->
  <script type="text/javascript" src="js/objects.js"></script>
  <script type="text/javascript" src="js/views.js"></script>
  <script type="text/javascript" src="js/app.js"></script>
</head>

<body>

<nav class="navbar navbar-inverse navbar-static-top" role="navigation">
  <div class="container">
    <a class="navbar-brand" href="#">Configurator</a>
  </div>
</nav>

<div class="container">
<form>

<div class="row">
  <div class="col-xs-8">
    <h1 id="general">General</h1>

    <div class="row">
      <div class="col-xs-6">
        <div class="form-group">
          <label for="cfg-config-name"><b>Config name</b></label>
          <input class="form-control" id="cfg-config-name" name="cfg-config-name" type="text"  placeholder="Config name">
        </div>
      </div>

      <div class="col-xs-6">
        <div class="form-group">
          <label for="cfg-config-timestamp"><b>Generated (timestamp)</b></label>
          <input class="form-control" id="cfg-config-timestamp" name="cfg-config-timestamp" type="text" value="" disabled>
        </div>
      </div>
    </div>

    <hr>

    <div id="families">

    <h1>
      Families
      <a id="add-family" href="#" class="btn btn-default" style="margin-top:4px; float:right;"><i class="fa fa-plus"></i></a>
    </h1>

    </div>

    <hr>

    <h1 id="download">
      Download
      <a href="#" id="download-config" class="btn btn-default" style="margin-top:4px; float:right;"><i class="fa fa-download"></i></a>
    </h1>

    <pre id="cfg-config-download"></pre>
  </div>
  <div class="col-xs-3 col-xs-offset-1">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h2 class="panel-title">Nav</h2>
      </div>
      <div class="list-group">
        <a href="#general" class="list-group-item">General</a>
        <a href="#families" class="list-group-item">Families</a>
        <a href="#download" class="list-group-item">Download</a>
      </div>
    </div>
  </div>
</div>

</form>
</div>

<script type="text/javascript">

window.families = [];

window.stampConfig = function() {
  $('#cfg-config-timestamp').val(moment().format('X'));
  $('#cfg-config-download').html(JSON.stringify(Utils.buildConfig(), undefined, 2));
}

var addFamily = function() {
  var family = new Family();
  window.families.push(family);

  var el = $('<div></div>');

  var familyView = new FamilyView(el, family);
  familyView.render();
  $('#families').append(el);

  family.on('change', function() {
    stampConfig();
  });

  stampConfig();
}

$(document).ready(function() {
  addFamily();

  $('#add-family').on('click', function(e) {
    addFamily();
    e.preventDefault();
  });

  $('#cfg-config-name').on('change keyup', window.stampConfig);

  $('#download-config').on('click', function(e) {
    var blob = new Blob([JSON.stringify(Utils.buildConfig(), undefined, 2)], {type: "application/json;charset=utf-8"});
    saveAs(blob, "config.json");
    e.preventDefault();
  });

  stampConfig();
});
</script>

</body>

</html>
